<div class="group-details-container">
  <!-- Page Header -->
  <app-page-header
    [title]="'Group: ' + groupId"
    [showViewToggle]="false"
    [showPagination]="false">
  </app-page-header>

  <!-- Loading State -->
  <app-loading-indicator
    *ngIf="loading && !hasError"
    size="large"
    title="Loading Group"
    message="Please wait while we load the group details from the registry..."
    [showText]="true">
  </app-loading-indicator>

  <!-- Error State -->
  <app-error-boundary
    *ngIf="hasError && !loading"
    [errorState]="{hasError: true, error: {name: 'GroupLoadError', message: errorMessage || 'Unknown error occurred'}}"
    [showDetails]="!!errorDetails"
    [errorTitle]="'Unable to Load Group'"
    [errorMessage]="errorMessage || 'An unexpected error occurred while loading the group'"
    (retry)="retryLoadGroup()">
  </app-error-boundary>

  <!-- Progressive Loading Indicator -->
  <app-loading-indicator
    *ngIf="loadingProgress && (group$ | async) && !hasError"
    size="inline"
    title="Loading Additional Data"
    [message]="'Loading group data from additional endpoints...'"
    [showText]="true">
  </app-loading-indicator>

  <!-- Main Content -->
  <ng-container *ngIf="!hasError && !loading">
    <div *ngIf="group$ | async as group" class="group-detail">

      <!-- Group Header -->
      <div class="group-header-container">
        <h3>{{ group.name || group['messagegroupid'] || group.id }}</h3>

        <!-- Deprecation Indicator -->
        <app-deprecation-indicator
          *ngIf="group.deprecated"
          [size]="'medium'"
          [deprecatedAt]="group.deprecated"
          [deprecationInfo]="group.deprecated">
        </app-deprecation-indicator>
      </div>

      <!-- Origin -->
      <div class="origin-field" *ngIf="group.origin">Origin: {{ group.origin }}</div>

      <!-- Description -->
      <p class="group-description" *ngIf="group.description">{{ group.description }}</p>

      <!-- Group Metadata as attributes using resource-document pattern -->
      <app-resource-document
        [resourceDocument]="group"
        [resourceAttributes]="getGroupMetadataAttributes()"
        [showAttributes]="true"
        [showDocument]="false"
        [initialExpanded]="true">
      </app-resource-document>

      <!-- Resource Types Section -->
      <div class="resource-types-section" *ngIf="resourceTypes.length > 0">
        <h3>Resource Types</h3>
        <div class="resource-types-grid">
          <a *ngFor="let rt of resourceTypes"
             [routerLink]="['/', groupType, groupId, rt.name]"
             class="resource-type-link">
            <div class="resource-type-header">
              <app-icon name="list"></app-icon>
              <span class="resource-type-name">{{ rt.plural }}</span>
              <span class="resource-count" *ngIf="rt.count !== undefined">({{ rt.count }})</span>
            </div>
            <p class="resource-type-description" *ngIf="rt.description">{{ rt.description }}</p>
          </a>
        </div>
      </div>

      <!-- Additional Attributes Section using resource-document pattern -->
      <div class="custom-attributes-section" *ngIf="displayAttributes.length > 0">
        <h3>Additional Attributes</h3>
        <div class="attributes-list">
          <ng-container *ngFor="let attrName of displayAttributes">
            <div class="attribute-item" *ngIf="hasValue(group[attrName])">
              <app-resource-document-item
                [item]="{
                  key: attrName,
                  value: group[attrName],
                  type: groupAttributes[attrName]?.type || typeof group[attrName],
                  description: groupAttributes[attrName]?.description,
                  itemModel: groupAttributes[attrName],
                  isExpanded: false
                }"
                [nestingLevel]="0"
                [initialExpanded]="false">
              </app-resource-document-item>
            </div>
          </ng-container>
        </div>
      </div>

      <!-- Empty State for No Additional Data -->
      <app-empty-state
        *ngIf="resourceTypes.length === 0 && displayAttributes.length === 0"
        icon="info"
        title="No Additional Information"
        message="This group has no resource types or custom attributes defined.">
      </app-empty-state>

    </div>
  </ng-container>
</div>
