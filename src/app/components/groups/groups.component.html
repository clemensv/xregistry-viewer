<app-page-header
  [title]="(modelService.getRegistryModel() | async)?.groups?.[groupType]?.plural || 'Registry Groups'"
  [showViewToggle]="true"
  [currentViewMode]="viewMode"
  [showPagination]="useClientSidePagination"
  [pageLinks]="pageLinks"
  [resultsCount]="filteredGroupsList.length || 0"
  [totalCount]="useClientSidePagination ? allGroupsCache.length || 0 : 0"
  [resultsText]="'groups'"
  [searchResultsText]="currentSearchTerm ? 'Showing ' + (filteredGroupsList.length || 0) + ' groups (filtered from ' + (groupsList.length || 0) + ')' : ''"
  (viewModeChange)="setViewMode($event)"
  (pageChange)="onPageChange($event)">
</app-page-header>

<!-- Progressive loading indicator -->
<div class="loading-progress" *ngIf="loadingProgress && groupsList.length > 0">
  <div class="loading-indicator">
    <fluent-progress-ring indeterminate diameter="16" class="loading-spinner"></fluent-progress-ring>
    <span>Loading more groups... ({{ groupsList.length }} loaded)</span>
  </div>
</div>

<!-- Cards View --><div class="groups">  <div *ngIf="viewMode === 'cards' && filteredGroupsList.length > 0" class="grid-container cards-view">
    <fluent-card *ngFor="let group of filteredGroupsList" class="group-card">
      <fluent-card-header>
        <fluent-card-title>
          <fluent-icon slot="prefix" name="folder"></fluent-icon>
          {{ group['name'] || group['id'] }}
        </fluent-card-title>
        <fluent-badge slot="subtitle" *ngIf="group.origin">Origin: {{ group.origin }}</fluent-badge>
      </fluent-card-header>
      <fluent-divider></fluent-divider>
       <div class="attribute simple-attribute description-attribute" *ngIf="group['description']">
         <div class="attribute-value">
           {{ group['description'] }}
         </div>
       </div>

       <!-- Group Attributes Display -->
       <ng-container *ngFor="let attrName of displayGroupAttributes">
        <div class="attribute simple-attribute group-attributes" *ngIf="hasValue(group[attrName])">
          <!-- Only show attribute header for complex attributes -->
          <div class="attribute-header" *ngIf="!isSimpleAttribute(group[attrName])">
            <strong>{{ attrName }}</strong>
            <span class="attribute-type" *ngIf="groupAttributes[attrName]?.type">{{ groupAttributes[attrName].type }}</span>
          </div>
          <div class="attribute-value">
            <app-resource-document-item               [item]="{                key: attrName,                value: group[attrName],                type: groupAttributes[attrName]?.type || typeof group[attrName],                description: groupAttributes[attrName]?.description,                itemModel: groupAttributes[attrName],                isExpanded: false              }"              [nestingLevel]="0"              [initialExpanded]="false">            </app-resource-document-item>
          </div>
        </div>
      </ng-container>        <!-- Resource Types Section - styled like other attributes -->
      <div class="attribute simple-attribute group-attributes" *ngIf="getResourceTypesItem(group)?.value.length > 0">
        <div class="attribute-value">
          <div class="field-group resource-types-field">
            <div class="value-box">
              <!-- Field label positioned at top left like other attributes -->
              <span class="field-label">Resource Types</span>

              <!-- Value content area -->
              <div class="value-content resource-types-container">
                <div class="resource-types-list">
                  <ng-container *ngFor="let rt of getResourceTypesItem(group)?.value">
                    <div class="resource-type-row">
                      <a [routerLink]="['/', groupType, group['id'], rt.name]" class="resource-link">{{ rt.name }}</a>
                      <span *ngIf="rt.count !== undefined" class="resource-count">({{ rt.count }})</span>
                    </div>
                  </ng-container>
                </div>
              </div>

              <!-- Type pill positioned like other attributes -->
              <span class="type-pill">Array, {{ getResourceTypesItem(group)?.value.length }} {{ getResourceTypesItem(group)?.value.length === 1 ? 'item' : 'items' }}</span>

              <!-- Copy button for consistency -->
              <button class="copy-btn"
                      [attr.aria-label]="'Copy Resource Types value'"
                      title="Copy value"
                      (click)="$event.stopPropagation();">
                <fluent-icon name="copy"></fluent-icon>
              </button>
            </div>
          </div>
        </div>
      </div>
      <fluent-card-footer>
        <small>
          <span [title]="getFullText(formatDateShort(group['createdAt']))">Created: {{ formatDateShort(group['createdAt']) }}</span>
          <span [title]="getFullText(formatDateShort(group['modifiedAt']))">Modified: {{ formatDateShort(group['modifiedAt']) }}</span>
        </small>
      </fluent-card-footer>
    </fluent-card>
  </div>

  <!-- List View -->
  <div *ngIf="viewMode === 'list' && filteredGroupsList.length > 0" class="list-view">
    <table class="groups-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
          <th>Origin</th>
          <th>Resource Types</th>
          <th>Created At</th>
          <th>Modified At</th>
        </tr>
      </thead>
      <tbody>
        <!-- Use tr with app-group-row attribute -->
        <tr *ngFor="let group of filteredGroupsList"
            app-group-row
            [group]="group"
            [groupType]="groupType"
            [resourceTypes]="getResourceTypesItem(group)?.value || []">
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Loading state -->
  <div *ngIf="loading && !hasApiError" class="empty-state">
    <div class="empty-state-content">
      <fluent-progress-ring indeterminate diameter="32" class="empty-state-icon"></fluent-progress-ring>
      <h3 class="empty-state-title">Loading Groups</h3>
      <p class="empty-state-message">
        Please wait while we load the available groups from the registry...
      </p>
    </div>
  </div>

  <!-- Error state when ALL APIs fail -->
  <div *ngIf="hasApiError && totalFailure" class="empty-state error-state">
    <div class="empty-state-content">
      <fluent-icon class="error-icon" name="error"></fluent-icon>
      <h3 class="empty-state-title">Unable to Load Groups</h3>
      <p class="empty-state-message">
        {{ apiErrorMessage }}
      </p>
      <div *ngIf="apiErrorDetails && apiErrorDetails.length > 1" class="error-details">
        <details>
          <summary>View detailed error information</summary>
          <div class="error-endpoints">
            <div *ngFor="let apiError of apiErrorDetails" class="error-endpoint">
              <strong>{{ apiError.api }}:</strong>
              <span class="error-message">{{ apiError.error?.message || apiError.error?.toString() || 'Unknown error' }}</span>
            </div>
          </div>
        </details>
      </div>
      <div class="error-actions">
        <fluent-button appearance="outline" (click)="loadGroups()">
          <fluent-icon slot="start" name="refresh"></fluent-icon>
          Retry Loading
        </fluent-button>
      </div>
    </div>
  </div>

  <!-- Partial failure warning (when some APIs work) -->
  <div *ngIf="partialFailure && !totalFailure && groupsList.length > 0" class="partial-failure-warning">
    <div class="warning-content">
      <fluent-icon name="warning" class="warning-icon"></fluent-icon>
      <span class="warning-text">
        Some registry endpoints are unavailable. Showing available groups from working endpoints.
      </span>
    </div>
  </div>

  <!-- Empty search results -->
  <div *ngIf="!loading && currentSearchTerm && filteredGroupsList.length === 0 && groupsList.length > 0" class="empty-state">
    <div class="empty-state-content">
      <fluent-icon class="empty-state-icon" name="search_off"></fluent-icon>
      <h3 class="empty-state-title">No Matching Groups</h3>
      <p class="empty-state-message">
        No groups match your search criteria "{{ currentSearchTerm }}".
        Try adjusting your search terms or browse all available groups.
      </p>
    </div>
  </div>

  <!-- No data state -->
  <div *ngIf="!loading && !currentSearchTerm && groupsList.length === 0" class="empty-state">
    <div class="empty-state-content">
      <fluent-icon class="empty-state-icon" name="folder_open"></fluent-icon>
      <h3 class="empty-state-title">No Groups Available</h3>
      <p class="empty-state-message">
        There are currently no groups of type "{{ groupType }}" in this registry.
        Groups contain resources and define their organizational structure.
      </p>
    </div>
  </div>
</div>
