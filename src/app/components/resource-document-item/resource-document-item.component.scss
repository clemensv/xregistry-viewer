@use '../shared-variables' as vars;
@use '../shared-colors' as colors;
@use '../shared-breakpoints' as breakpoints;
@use '../shared-design-tokens' as tokens;
@use '../_vertical-bars' as vbars;
@use '../../../styles/theme' as *;

// Animation and mixins
@keyframes flash {
  0% { background-color: rgba(0, 128, 255, 0.3); }
  100% { background-color: transparent; }
}

@mixin item-border($color) {
  border-left: 3px solid $color;
  position: relative;
  &::before {
    content: '';
    position: absolute;
    top: 0;
    bottom: 0;
    left: -3px;
    width: 3px;
    height: 100%;
    background-color: $color;
    z-index: tokens.z-index('base');
  }
}

@mixin hover-transition {
  @include tokens.transition('all');
  &:hover:not(:disabled) {
    background-color: var(--bg-hover, #f1f3f4);
    border-color: var(--fg-border, #d0d7de);
  }
}

@mixin button-style {
  background: transparent;
  border: 1px solid var(--fg-border, #ddd);
  @include tokens.radius('sm');
  padding: 0.25rem;
  cursor: pointer;
  color: var(--fg-secondary-text, #666);
  font-size: vars.$small-size;
  @include hover-transition;

  &:hover {
    background: var(--bg-hover, #f8f9fa);
    border-color: colors.primary();
    color: colors.primary();
  }
  fluent-icon, .icon-span {
    font-size: 14px;
    line-height: 1;
  }
}

// Field Group Layout - Keep existing Fluent Design but add type pill
.field-group {
  margin-bottom: 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;

  // Value box contains everything and extends full width
  .value-box {
    position: relative; // ensure positioning context
    display: flex;
    align-items: center;
    gap: 0.5rem;
    width: 100%;

    .info-icon {
      position: absolute;
      bottom: 6px;  // adjust as needed to be flush
      right: -0.6rem;   // adjust as needed to be flush
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 10px;
      height: 10px;
      color: var(--fg-secondary-text, #605e5c);
      cursor: default;

      fluent-icon {
        font-size: 6px;
        line-height: 1;
      }
    }
  }

  // Label positioned at top left, no box, just text
  .field-label {
    position: absolute;
    top: -9px;
    left: 12px;
    padding: 0 4px;
    font-size: 11px;
    font-weight: 600;
    color: var(--fg-secondary-text, #605e5c);
    background: var(--bg-card, #ffffff);
    z-index: 10;
    white-space: nowrap;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }

  // Value content takes all available space
  .value-content {
    flex: 1;
    min-width: 20ch;
    /* Add relative positioning so its children can be positioned relative to it,
       if you opt to move the info icon into it in the future. */
    position: relative;
  }

  // Keep existing Fluent input styling
  .numeric-input,
  .text-input {
    width: 100%;
    height: 32px;
    padding: 0 8px;
    border: 1px solid var(--fg-border, #8a8886);
    border-radius: 2px;
    font-size: 14px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--bg-card, #ffffff);
    color: var(--fg-text, #323130);
    outline: none;

    &:focus {
      border-color: var(--primary-color, #0078d4);
      box-shadow: 0 0 0 1px var(--primary-color, #0078d4);
    }

    &:disabled,
    &[readonly] {
      background: var(--bg-disabled, #f3f2f1);
      color: var(--fg-disabled, #a19f9d);
      border-color: var(--fg-border-disabled, #c8c6c4);
    }
  }

  // URL and XID links - full width
  .url-link,
  .xid-link {
    display: inline-flex;
    align-items: center;
    height: 32px;
    padding: 0 8px;
    border: 1px solid var(--fg-border, #8a8886);
    border-radius: 2px;
    font-size: 14px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--bg-card, #ffffff);
    color: var(--primary-color, #0078d4);
    text-decoration: none;
    width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;

    &:hover {
      background: var(--bg-hover, #f3f2f1);
      border-color: var(--primary-color, #0078d4);
    }

    fluent-icon {
      margin-left: auto;
      flex-shrink: 0;
      font-size: 12px;
    }
  }

  // Any value display - full width
  .any-value {
    height: auto;
    min-height: 32px;
    padding: 8px;
    border: 1px solid var(--fg-border, #8a8886);
    border-radius: 2px;
    background: var(--bg-card, #ffffff);
    width: 100%;
    overflow: hidden;
  }

  // Field description - with ellipsis and tooltip
  .field-desc {
    display: none;
  }

  // Copy button remains compact
  .copy-btn {
    width: 32px;
    height: 32px;
    background: transparent;
    border: 1px solid var(--fg-border, #8a8886);
    border-radius: 2px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    color: var(--fg-text, #323130);

    &:hover {
      background: var(--bg-hover, #f3f2f1);
      border-color: var(--primary-color, #0078d4);
      color: var(--primary-color, #0078d4);
    }

    fluent-icon {
      font-size: 16px;
    }
  }

  // Type pill styling - keep existing positioning
  .type-pill {
    position: absolute;
    top: -8px;
    /* Copy-button width (32) + gap (0.5 rem).  No extra 8 px inset. */
    right: calc(0.5rem + 32px);
    height: 15px;
    padding: 0 6px;
    font-size: 10px;
    font-weight: 500;
    line-height: 15px;
    color: #ffffff;
    background: #0078d4;
    border-radius: 8px;
    white-space: nowrap;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    z-index: 10;
  }

  // Responsive adjustments
  @media (max-width: 768px) {
    .field-label {
      font-size: 10px;
      top: -8px;
      left: 10px;
    }

    .type-pill {
      /* keep proportional offset on small screens */
      right: calc(32px + 0.5rem);
      font-size: 9px;
      height: 13px;
      line-height: 13px;
      padding: 0 5px;
      top: -7px;
      right: 6px;
      border-radius: 7px;
    }
  }

  @media (max-width: 480px) {
    .input-row {
      flex-direction: column;
      align-items: stretch;
      gap: 0.5rem;
    }

    .field-title {
      min-width: auto;
    }

    .type-pill {
      top: -7px;
      right: 8px;
    }

    .copy-btn {
      align-self: center;
    }
  }
}

// Main component - minimal styles for complex items only
.resource-document-item {
  margin: 0;
  display: block;
  position: relative;

  &.nested {
    padding-left: 0.5rem;
    margin-bottom: 0;
  }

  // Unified row styling for complex items (arrays/objects)
  .unified-item-row {
    display: flex;
    flex-direction: row;
    align-items: center;
    flex-wrap: wrap;
    padding: 0.5rem;
    border-radius: 0.375rem;
    border: 1px solid var(--fg-border, #ddd);
    margin-bottom: 0.25rem;
    cursor: pointer;
    background-color: var(--bg-hover, #f8f9fa);

    &.expanded {
      margin-bottom: 0;
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
    }

    // Array-specific styling
    &.array-row {
      border-left: 3px solid #5bc0de;
      &.expanded {
        background-color: rgba(91, 192, 222, 0.1);
      }
    }

    // Object-specific styling
    &.object-row {
      border-left: 3px solid #9575cd;
      &.expanded {
        background-color: rgba(149, 117, 205, 0.1);
      }
    }

    strong {
      font-weight: 600;
      color: var(--fg-text, #2c3e50);
      margin-right: 0.5rem;
    }

    .toggle-icon {
      margin-right: 0.5rem;
      background: transparent;
      border: none;
      cursor: pointer;
      padding: 2px;
      border-radius: 0.375rem;

      fluent-icon {
        font-size: 1.2rem;
        color: var(--fg-text, #333);
      }
    }

    .item-count {
      color: var(--fg-secondary-text, #6c757d);
      font-size: 0.875rem;
      margin-right: 0.5rem;
    }

    .item-model-type {
      color: var(--info-color, #457B9D);
      font-size: 0.875rem;
      background-color: var(--bg-elevated, #F1FAEE);
      padding: 2px 6px;
      border-radius: 0.25rem;
      border: 1px solid var(--fg-border, #A8DADC);
      margin-right: 0.75rem;
    }

    .item-description {
      color: var(--fg-secondary-text, #6c757d);
      font-size: 0.875rem;
      font-style: italic;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-right: auto;
    }
  }

  // Expanded content styling
  .expanded-content {
    background-color: var(--bg-elevated, rgba(240, 240, 240, 0.3));
    border: 1px solid var(--fg-border, #ddd);
    border-top: none;
    border-radius: 0 0 0.375rem 0.375rem;
    padding: 0.5rem;

    .array-items, .object-items {
      margin-bottom: 0.25rem;

      .detail-row {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;

        .detail-label {
          font-size: 0.85rem;
          color: var(--fg-secondary-text, #495057);

          .detail-value {
            font-weight: 600;
            color: var(--fg-text, #333);
          }
        }
      }
    }

    .simple-items-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 0.75rem;
      padding: 0.25rem;
    }

    .complex-items-container {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .items-separator {
      margin: 0.5rem 0;

      hr {
        border: none;
        border-top: 1px solid var(--fg-border, #ddd);
        margin: 0.5rem 0;
      }

      .separator-label {
        font-size: 0.875rem;
        color: var(--fg-secondary-text, #666);
        font-weight: 500;
      }
    }
  }

  // Collapsed preview styling
  .collapsed-preview {
    background-color: var(--bg-elevated, rgba(240, 240, 240, 0.3));
    border: 1px solid var(--fg-border, #ddd);
    border-top: none;
    border-radius: 0 0 0.375rem 0.375rem;
    padding: 0.5rem;
    cursor: pointer;

    &:hover {
      background-color: var(--bg-hover, #f8f9fa);
    }

    .preview-content {
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
      color: var(--fg-secondary-text, #666);
    }

    .preview-summary {
      font-style: italic;
    }
  }
}
